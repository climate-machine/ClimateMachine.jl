<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Soil Heat Equation Â· ClimateMachine</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-191640394-1', 'auto');
ga('send', 'pageview', {'page': location.pathname + location.search + location.hash});
</script><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../../../assets/documenter.js"></script><script src="../../../../../siteinfo.js"></script><script src="../../../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../../../"><img src="../../../../../assets/logo.svg" alt="ClimateMachine logo"/></a><div class="docs-package-name"><span class="docs-autofit">ClimateMachine</span></div><form class="docs-search" action="../../../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Getting started</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../GettingStarted/Installation/">Installation</a></li><li><a class="tocitem" href="../../../../../GettingStarted/Terminology/">Terminology</a></li><li><a class="tocitem" href="../../../../../GettingStarted/RunningClimateMachine/">Running</a></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Defaults</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../GettingStarted/Atmos/">Atmosphere model configurations</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../TutorialList/">Home</a></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">BalanceLaws</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../BalanceLaws/tendency_specification_layer/">Tendency specification</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../Atmos/heldsuarez/">Dry Idealized GCM (Held-Suarez)</a></li><li><a class="tocitem" href="../../../../Atmos/burgers_single_stack/">Single Element Stack Experiment (Burgers Equation)</a></li><li><a class="tocitem" href="../../../../Atmos/burgers_single_stack_fvm/">Finite Volume Single Element Stack Experiment (Burgers Equation)</a></li><li><a class="tocitem" href="../../../../Atmos/burgers_single_stack_bjfnk/">HEVI Single Element Stack Experiment (Burgers Equation)</a></li><li><a class="tocitem" href="../../../../Atmos/densitycurrent/">LES Experiment (Density Current)</a></li><li><a class="tocitem" href="../../../../Atmos/risingbubble/">LES Experiment (Rising Thermal Bubble)</a></li><li><a class="tocitem" href="../../../../Atmos/agnesi_hs_lin/">Linear Hydrostatic Mountain (Topography)</a></li><li><a class="tocitem" href="../../../../Atmos/agnesi_nh_lin/">Linear Non-Hydrostatic Mountain (Topography)</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox" checked/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Land</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-4-1" type="checkbox"/><label class="tocitem" for="menuitem-3-4-1"><span class="docs-label">Heat</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Heat/heat_equation/">Heat Equation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4-2" type="checkbox" checked/><label class="tocitem" for="menuitem-3-4-2"><span class="docs-label">Soil</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Water/hydraulic_functions/">Hydraulic Functions</a></li><li class="is-active"><a class="tocitem" href>Soil Heat Equation</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Import-necessary-modules"><span>Import necessary modules</span></a></li><li class="toplevel"><a class="tocitem" href="#Preliminary-set-up"><span>Preliminary set-up</span></a></li><li class="toplevel"><a class="tocitem" href="#Determine-soil-parameters"><span>Determine soil parameters</span></a></li><li class="toplevel"><a class="tocitem" href="#Initial-and-Boundary-conditions"><span>Initial and Boundary conditions</span></a></li><li class="toplevel"><a class="tocitem" href="#Create-the-model-structure"><span>Create the model structure</span></a></li><li class="toplevel"><a class="tocitem" href="#Specify-the-numerical-details"><span>Specify the numerical details</span></a></li><li class="toplevel"><a class="tocitem" href="#Run-the-integration"><span>Run the integration</span></a></li><li class="toplevel"><a class="tocitem" href="#Plot-results-and-comparison-data-from-[Bonan19a](@cite)"><span>Plot results and comparison data from G. Bonan  (2019)</span></a></li><li class="toplevel"><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../../Water/equilibrium_test/">Richards Equation</a></li><li><a class="tocitem" href="../../Coupled/equilibrium_test/">Coupled Water and Heat</a></li><li><a class="tocitem" href="../../PhaseChange/freezing_front/">Phase Change I</a></li><li><a class="tocitem" href="../../PhaseChange/phase_change_analytic_test/">Phase Change II</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Ocean</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../Ocean/geostrophic_adjustment/">One-dimensional geostrophic adjustment</a></li><li><a class="tocitem" href="../../../../Ocean/internal_wave/">Propagating mode-1 internal wave</a></li><li><a class="tocitem" href="../../../../Ocean/shear_instability/">Shear instability</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6" type="checkbox"/><label class="tocitem" for="menuitem-3-6"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-6-1" type="checkbox"/><label class="tocitem" for="menuitem-3-6-1"><span class="docs-label">System Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../Numerics/SystemSolvers/cg/">Conjugate Gradient</a></li><li><a class="tocitem" href="../../../../Numerics/SystemSolvers/bgmres/">Batched Generalized Minimal Residual</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6-2" type="checkbox"/><label class="tocitem" for="menuitem-3-6-2"><span class="docs-label">DG Methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../Numerics/DGMethods/showcase_filters/">Filters</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6-3" type="checkbox"/><label class="tocitem" for="menuitem-3-6-3"><span class="docs-label">Time-Stepping</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../Numerics/TimeStepping/ts_intro/">Introduction</a></li><li><input class="collapse-toggle" id="menuitem-3-6-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-6-3-2"><span class="docs-label">Explicit Runge-Kutta methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../Numerics/TimeStepping/explicit_lsrk/">Single-rate Explicit Timestepping</a></li><li><a class="tocitem" href="../../../../Numerics/TimeStepping/tutorial_risingbubble_config/">Rising Thermal Bubble Configuration</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-6-3-3"><span class="docs-label">Implicit-Explicit (IMEX) Additive Runge-Kutta methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../Numerics/TimeStepping/imex_ark/">Implicit-Explicit (IMEX) Additively-Partitioned Runge-Kutta Timestepping</a></li><li><a class="tocitem" href="../../../../Numerics/TimeStepping/tutorial_acousticwave_config/">Acoustic Wave Configuration</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-6-3-4"><span class="docs-label">Multirate Runge-Kutta methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../Numerics/TimeStepping/multirate_rk/">Multirate Runge-Kutta Timestepping</a></li><li><a class="tocitem" href="../../../../Numerics/TimeStepping/tutorial_risingbubble_config/">Rising Thermal Bubble Configuration</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-6-3-5"><span class="docs-label">MIS methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../Numerics/TimeStepping/mis/">Multirate Infinitesimal Step (MIS) Timestepping</a></li><li><a class="tocitem" href="../../../../Numerics/TimeStepping/tutorial_acousticwave_config/">Acoustic Wave Configuration</a></li></ul></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-7" type="checkbox"/><label class="tocitem" for="menuitem-3-7"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-7-1" type="checkbox"/><label class="tocitem" for="menuitem-3-7-1"><span class="docs-label">Debug</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../Diagnostics/Debug/StateCheck/">State Statistics Regression</a></li></ul></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">How-to-guides</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../HowToGuides/Common/UniversalFunctions/">Universal Functions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Balance Laws</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../HowToGuides/BalanceLaws/how_to_make_a_balance_law/">How to make a balance law</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../HowToGuides/Atmos/AtmosReferenceState/">Reference profiles</a></li><li><a class="tocitem" href="../../../../../HowToGuides/Atmos/MoistureModelChoices/">Moisture model</a></li><li><a class="tocitem" href="../../../../../HowToGuides/Atmos/PrecipitationModelChoices/">Precipitation model</a></li><li><a class="tocitem" href="../../../../../HowToGuides/Atmos/MoistureAndPrecip/">How to create an experiment with moisture and precipitation</a></li></ul></li><li><span class="tocitem">Ocean</span></li><li><span class="tocitem">Land</span></li><li><input class="collapse-toggle" id="menuitem-4-6" type="checkbox"/><label class="tocitem" for="menuitem-4-6"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><span class="tocitem">Meshes</span></li><li><input class="collapse-toggle" id="menuitem-4-6-2" type="checkbox"/><label class="tocitem" for="menuitem-4-6-2"><span class="docs-label">ODE Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../HowToGuides/Numerics/ODESolvers/Timestepping/">Time-integration</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-6-3" type="checkbox"/><label class="tocitem" for="menuitem-4-6-3"><span class="docs-label">System Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../HowToGuides/Numerics/SystemSolvers/IterativeSolvers/">Iterative Solvers</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-7" type="checkbox"/><label class="tocitem" for="menuitem-4-7"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../HowToGuides/Diagnostics/UsingDiagnostics/">Using Diagnostics</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">APIs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/">Home</a></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Driver</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/Driver/">Top level interface</a></li><li><a class="tocitem" href="../../../../../APIs/Driver/Checkpoint/">Checkpoint</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/Atmos/AtmosModel/">AtmosModel</a></li><li><a class="tocitem" href="../../../../../APIs/Atmos/Microphysics_0M/">Microphysics_0M</a></li><li><a class="tocitem" href="../../../../../APIs/Atmos/Microphysics/">Microphysics</a></li></ul></li><li><a class="tocitem" href="../../../../../APIs/Ocean/Ocean/">Ocean</a></li><li><input class="collapse-toggle" id="menuitem-5-5" type="checkbox"/><label class="tocitem" for="menuitem-5-5"><span class="docs-label">Land</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/Land/LandModel/">Land Model</a></li><li><a class="tocitem" href="../../../../../APIs/Land/Runoff/">Runoff Parameterizations</a></li><li><a class="tocitem" href="../../../../../APIs/Land/SoilWaterParameterizations/">Soil Water Parameterizations</a></li><li><a class="tocitem" href="../../../../../APIs/Land/SoilHeatParameterizations/">Soil Heat Parameterizations</a></li><li><a class="tocitem" href="../../../../../APIs/Land/SurfaceFlow/">Surface Flow</a></li><li><a class="tocitem" href="../../../../../APIs/Land/RadiativeEnergyFlux/">Radiative Boundary Conditions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-6" type="checkbox"/><label class="tocitem" for="menuitem-5-6"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/Common/Orientations/">Orientations</a></li><li><a class="tocitem" href="../../../../../APIs/Common/CartesianDomains/">Cartesian Domains</a></li><li><a class="tocitem" href="../../../../../APIs/Common/CartesianFields/">Cartesian Fields</a></li><li><a class="tocitem" href="../../../../../APIs/Common/Spectra/">Spectra</a></li><li><a class="tocitem" href="../../../../../APIs/Common/SurfaceFluxes/">Surface Fluxes</a></li><li><a class="tocitem" href="../../../../../APIs/Common/TurbulenceClosures/">Turbulence Closures</a></li><li><a class="tocitem" href="../../../../../APIs/Common/TurbulenceConvection/">Turbulence Convection</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-7" type="checkbox"/><label class="tocitem" for="menuitem-5-7"><span class="docs-label">Balance Laws</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/BalanceLaws/BalanceLaws/">Balance Laws</a></li><li><a class="tocitem" href="../../../../../APIs/BalanceLaws/Problems/">Problems</a></li></ul></li><li><a class="tocitem" href="../../../../../APIs/Arrays/Arrays/">Arrays</a></li><li><input class="collapse-toggle" id="menuitem-5-9" type="checkbox"/><label class="tocitem" for="menuitem-5-9"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/Diagnostics/Diagnostics/">Diagnostics groups</a></li><li><a class="tocitem" href="../../../../../APIs/Diagnostics/DiagnosticsMachine/">DiagnosticsMachine</a></li><li><a class="tocitem" href="../../../../../APIs/Diagnostics/StdDiagnostics/">StdDiagnostics</a></li><li><a class="tocitem" href="../../../../../APIs/Diagnostics/StateCheck/">State Check</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-10" type="checkbox"/><label class="tocitem" for="menuitem-5-10"><span class="docs-label">Input/Output</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/InputOutput/">Input/Output</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-11" type="checkbox"/><label class="tocitem" for="menuitem-5-11"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/Numerics/Meshes/Mesh/">Meshes</a></li><li><a class="tocitem" href="../../../../../APIs/Numerics/SystemSolvers/SystemSolvers/">SystemSolvers</a></li><li><a class="tocitem" href="../../../../../APIs/Numerics/ODESolvers/ODESolvers/">ODESolvers</a></li><li><a class="tocitem" href="../../../../../APIs/Numerics/DGMethods/DGMethods/">DG Methods</a></li><li><a class="tocitem" href="../../../../../APIs/Numerics/DGMethods/Courant/">Courant</a></li><li><a class="tocitem" href="../../../../../APIs/Numerics/DGMethods/NumericalFluxes/">Numerical Fluxes</a></li><li><a class="tocitem" href="../../../../../APIs/Numerics/DGMethods/FVReconstructions/">Finite Volume Reconstructions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-12" type="checkbox"/><label class="tocitem" for="menuitem-5-12"><span class="docs-label">Utilities</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/Utilities/VariableTemplates/">Variable Templates</a></li><li><a class="tocitem" href="../../../../../APIs/Utilities/SingleStackUtils/">Single Stack Utilities</a></li><li><a class="tocitem" href="../../../../../APIs/Utilities/TicToc/">Tic Toc</a></li></ul></li></ul></li><li><a class="tocitem" href="../../../../../Contributing/">Contribution guide</a></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Theory</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-7-1" type="checkbox"/><label class="tocitem" for="menuitem-7-1"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../Theory/Common/SurfaceFluxes/">SurfaceFluxes</a></li><li><a class="tocitem" href="../../../../../Theory/Common/Turbulence/">Turbulence Closures</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7-2" type="checkbox"/><label class="tocitem" for="menuitem-7-2"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../Theory/Atmos/AtmosModel/">AtmosModel</a></li><li><a class="tocitem" href="../../../../../Theory/Atmos/EDMF_plots/">EDMF Model</a></li><li><a class="tocitem" href="../../../../../Theory/Atmos/Microphysics_0M/">Microphysics_0M</a></li><li><a class="tocitem" href="../../../../../Theory/Atmos/Microphysics/">Microphysics</a></li><li><a class="tocitem" href="../../../../../Theory/Atmos/EDMFEquations/">EDMF equations</a></li><li><a class="tocitem" href="../../../../../Theory/Atmos/Model/tracers/">Tracers</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">Developer docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../DevDocs/CodeStyle/">Coding style</a></li><li><a class="tocitem" href="../../../../../DevDocs/AcceptableUnicode/">Acceptable Unicode</a></li><li><a class="tocitem" href="../../../../../DevDocs/ModelVariableList/">Model variable list</a></li><li><a class="tocitem" href="../../../../../DevDocs/ModelOutput/">Model output</a></li><li><a class="tocitem" href="../../../../../DevDocs/DiagnosticVariableList/">Diagnostic variable list</a></li><li><a class="tocitem" href="../../../../../DevDocs/SystemImage/">Custom System Image</a></li></ul></li><li><a class="tocitem" href="../../../../../References/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li><a class="is-disabled">Land</a></li><li><a class="is-disabled">Soil</a></li><li class="is-active"><a href>Soil Heat Equation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Soil Heat Equation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimateMachine.jl/../../../../../.." title="Edit on GitHub"><span class="docs-icon fab">ï</span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Solving-the-heat-equation-in-soil"><a class="docs-heading-anchor" href="#Solving-the-heat-equation-in-soil">Solving the heat equation in soil</a><a id="Solving-the-heat-equation-in-soil-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-the-heat-equation-in-soil" title="Permalink"></a></h1><p>This tutorial shows how to use CliMA code to solve the heat equation in soil. For background on the heat equation in general, and how to solve it using CliMA code, please see the <a href="../../../Heat/heat_equation/"><code>heat_equation.jl</code></a> tutorial.</p><p>The version of the heat equation we are solving here assumes no sources or sinks and no flow of liquid water. It takes the form</p><p><span>$\frac{â Ïe_{int}}{â t} =  â â Îº(Î¸_l, Î¸_i; Î½, ...) âT$</span></p><p>Here</p><p><span>$t$</span> is the time (s),</p><p><span>$z$</span> is the location in the vertical (m),</p><p><span>$Ïe_{int}$</span> is the volumetric internal energy of the soil (J/m^3),</p><p><span>$T$</span> is the temperature of the soil (K),</p><p><span>$Îº$</span> is the thermal conductivity (W/m/K),</p><p><span>$Ï_l$</span> is the augmented volumetric liquid water fraction,</p><p><span>$Î¸_i$</span> is the volumetric ice fraction, and</p><p><span>$Î½, ...$</span> denotes parameters relating to soil type, such as porosity.</p><p>We will solve this equation in an effectively 1-d domain with <span>$z â [-1,0]$</span>, and with the following boundary and initial conditions:</p><p><span>$T(t=0, z) = 277.15^\circ K$</span></p><p><span>$T(t, z = 0) = 288.15^\circ K$</span></p><p><span>$-Îº âT(t, z = -1) = 0 zÌ$</span></p><p>The temperature <span>$T$</span> and volumetric internal energy <span>$Ïe_{int}$</span> are related as</p><p><span>$Ïe_{int} = Ïc_s (Î¸_l, Î¸_i; Î½, ...) (T - T_0) - Î¸_i Ï_i LH_{f0}$</span></p><p>where</p><p><span>$Ïc_s$</span> is the volumetric heat capacity of the soil (J/m^3/K),</p><p><span>$T_0$</span> is the freezing temperature of water,</p><p><span>$Ï_i$</span> is the density of ice (kg/m^3), and</p><p><span>$LH_{f0}$</span> is the latent heat of fusion at <span>$T_0$</span>.</p><p>In this tutorial, we will use a <a href="../../../../../APIs/Land/LandModel/#ClimateMachine.Land.PrescribedWaterModel"><code>PrescribedWaterModel</code></a>. This option allows the user to specify a function for the spatial and temporal behavior of <code>Î¸_i</code> and <code>Î¸_l</code>; it does not solve Richard&#39;s equation for the evolution of moisture. Please see the tutorials in the <code>Soil/Coupled/</code> folder or the <code>Soil/Water/</code> folder for information on solving Richard&#39;s equation, either coupled or uncoupled from the heat equation, respectively.</p><h1 id="Import-necessary-modules"><a class="docs-heading-anchor" href="#Import-necessary-modules">Import necessary modules</a><a id="Import-necessary-modules-1"></a><a class="docs-heading-anchor-permalink" href="#Import-necessary-modules" title="Permalink"></a></h1><p>External (non - CliMA) modules</p><pre><code class="language-julia">using MPI
using OrderedCollections
using StaticArrays
using Statistics
using Dierckx
using Plots
using DelimitedFiles</code></pre><p>CliMA Parameters</p><pre><code class="language-julia">using CLIMAParameters
using CLIMAParameters.Planet: Ï_cloud_liq, Ï_cloud_ice, cp_l, cp_i, T_0, LH_f0</code></pre><p>ClimateMachine modules</p><pre><code class="language-julia">using ClimateMachine
using ClimateMachine.Land
using ClimateMachine.Land.SoilWaterParameterizations
using ClimateMachine.Land.SoilHeatParameterizations
using ClimateMachine.Mesh.Topologies
using ClimateMachine.Mesh.Grids
using ClimateMachine.DGMethods
using ClimateMachine.DGMethods.NumericalFluxes
using ClimateMachine.DGMethods: BalanceLaw, LocalGeometry
using ClimateMachine.MPIStateArrays
using ClimateMachine.GenericCallbacks
using ClimateMachine.ODESolvers
using ClimateMachine.VariableTemplates
using ClimateMachine.SingleStackUtils
using ClimateMachine.BalanceLaws:
    BalanceLaw,
    Prognostic,
    Auxiliary,
    Gradient,
    GradientFlux,
    vars_state,
    parameter_set
import ClimateMachine.DGMethods: calculate_dt
using ArtifactWrappers</code></pre><h1 id="Preliminary-set-up"><a class="docs-heading-anchor" href="#Preliminary-set-up">Preliminary set-up</a><a id="Preliminary-set-up-1"></a><a class="docs-heading-anchor-permalink" href="#Preliminary-set-up" title="Permalink"></a></h1><p>Get the parameter set, which holds constants used across CliMA models.</p><pre><code class="language-julia">struct EarthParameterSet &lt;: AbstractEarthParameterSet end
const param_set = EarthParameterSet();</code></pre><p>Initialize and pick a floating point precision.</p><pre><code class="language-julia">ClimateMachine.init()
const FT = Float32;</code></pre><pre><code class="language-none">[1623099499.176013] [hpc-92-37:16178:0]       ib_verbs.h:84   UCX  ERROR ibv_exp_query_device(mlx5_0) returned 38: No space left on device
</code></pre><p>Load functions that will help with plotting</p><pre><code class="language-julia">const clima_dir = dirname(dirname(pathof(ClimateMachine)));
include(joinpath(clima_dir, &quot;docs&quot;, &quot;plothelpers.jl&quot;));</code></pre><h1 id="Determine-soil-parameters"><a class="docs-heading-anchor" href="#Determine-soil-parameters">Determine soil parameters</a><a id="Determine-soil-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Determine-soil-parameters" title="Permalink"></a></h1><p>Below are the soil component fractions for various soil texture classes,  from <a href="../../../../../References/#Cosby1984">B.J. Cosby al.  (1984)</a> and <a href="../../../../../References/#Bonan19a">G. Bonan  (2019)</a>. Note that these fractions are volumetric fractions, relative to other soil solids, i.e. not including pore space. These are denoted <code>Î½_ss_i</code>; the CliMA Land Documentation uses the symbol <code>Î½_i</code> to denote the volumetric fraction of a soil component <code>i</code> relative to the soil, including pore space.</p><pre><code class="language-julia">Î½_ss_silt_array =
    FT.(
        [5.0, 12.0, 32.0, 70.0, 39.0, 15.0, 56.0, 34.0, 6.0, 47.0, 20.0] ./
        100.0,
    )
Î½_ss_quartz_array =
    FT.(
        [92.0, 82.0, 58.0, 17.0, 43.0, 58.0, 10.0, 32.0, 52.0, 6.0, 22.0] ./
        100.0,
    )
Î½_ss_clay_array =
    FT.(
        [3.0, 6.0, 10.0, 13.0, 18.0, 27.0, 34.0, 34.0, 42.0, 47.0, 58.0] ./
        100.0,
    )
porosity_array =
    FT.([
        0.395,
        0.410,
        0.435,
        0.485,
        0.451,
        0.420,
        0.477,
        0.476,
        0.426,
        0.492,
        0.482,
    ]);</code></pre><p>The soil types that correspond to array elements above are, in order, sand, loamy sand, sandy loam, silty loam, loam, sandy clay loam, silty clay loam, clay loam, sandy clay, silty clay, and clay.</p><p>Here we choose the soil type to be sandy. The soil column is uniform in space and time.</p><pre><code class="language-julia">soil_type_index = 1
Î½_ss_minerals =
    Î½_ss_clay_array[soil_type_index] + Î½_ss_silt_array[soil_type_index]
Î½_ss_quartz = Î½_ss_quartz_array[soil_type_index]
porosity = porosity_array[soil_type_index];</code></pre><p>This tutorial additionally compares the output of a ClimateMachine simulation with that of Supplemental Program 2, Chapter 5, of <a href="../../../../../References/#Bonan19a">G. Bonan  (2019)</a>.  We found this useful as it allows us compare results from our code against a published version.</p><p>The simulation code of <a href="../../../../../References/#Bonan19a">G. Bonan  (2019)</a> employs a formalism for the thermal conductivity <code>Îº</code> based on <a href="../../../../../References/#Johanson1975">O. Johanson  (1977)</a>. It assumes no organic matter, and only requires the volumetric fraction of soil solids for quartz and other minerals. ClimateMachine employs the formalism of <a href="../../../../../References/#BallandArp2005">V. Balland , P. A. Arp  (2005)</a>, which requires the fraction of soil solids for quartz, gravel, organic matter, and other minerals. <a href="../../../../../References/#Dai2019a">Yongjiu Dai al.  (2019)</a> found the model of <a href="../../../../../References/#BallandArp2005">V. Balland , P. A. Arp  (2005)</a> to better match measured soil properties across a range of soil types.</p><p>To compare the output of the two simulations, we set the organic matter content and gravel content to zero in the CliMA model. The remaining soil components (quartz and other minerals) match between the two. We also run the simulation for relatively wet soil (water content at 80% of porosity). Under these conditions, the two formulations for <code>Îº</code>, though taking different functional forms, are relatively consistent. The differences between models are important for soil with organic material and for soil that is relatively dry.</p><pre><code class="language-julia">Î½_ss_om = FT(0.0)
Î½_ss_gravel = FT(0.0);</code></pre><p>We next calculate a few intermediate quantities needed for the determination of the thermal conductivity (<a href="../../../../../References/#BallandArp2005">V. Balland , P. A. Arp  (2005)</a>). These include the conductivity of the solid material, the conductivity of saturated soil, and the conductivity of frozen saturated soil.</p><pre><code class="language-julia">Îº_quartz = FT(7.7) # W/m/K
Îº_minerals = FT(2.5) # W/m/K
Îº_om = FT(0.25) # W/m/K
Îº_liq = FT(0.57) # W/m/K
Îº_ice = FT(2.29); # W/m/K</code></pre><p>The particle density of soil solids in moisture-free soil is taken as a constant, across soil types, as in <a href="../../../../../References/#Bonan19a">G. Bonan  (2019)</a>. This is a good estimate for organic material free soil. The user is referred to <a href="../../../../../References/#BallandArp2005">V. Balland , P. A. Arp  (2005)</a> for a more general expression.</p><pre><code class="language-julia">Ïp = FT(2700) # kg/m^3
Îº_solid = k_solid(Î½_ss_om, Î½_ss_quartz, Îº_quartz, Îº_minerals, Îº_om)
Îº_sat_frozen = ksat_frozen(Îº_solid, porosity, Îº_ice)
Îº_sat_unfrozen = ksat_unfrozen(Îº_solid, porosity, Îº_liq);</code></pre><p>The thermal conductivity of dry soil is also required, but this is calculated internally using the expression of [3].</p><p>The volumetric specific heat of dry soil is chosen so as to match Bonan&#39;s simulation. The user could instead compute this using a volumetric fraction weighted average across soil components.</p><pre><code class="language-julia">Ïc_ds = FT((1 - porosity) * 1.926e06) # J/m^3/K</code></pre><pre><code class="language-none">1.16523f6</code></pre><p>Finally, we store the soil-specific parameters and functions in a place where they will be accessible to the model during integration.</p><pre><code class="language-julia">soil_param_functions = SoilParamFunctions(
    FT;
    porosity = porosity,
    Î½_ss_gravel = Î½_ss_gravel,
    Î½_ss_om = Î½_ss_om,
    Î½_ss_quartz = Î½_ss_quartz,
    Ïc_ds = Ïc_ds,
    Ïp = Ïp,
    Îº_solid = Îº_solid,
    Îº_sat_unfrozen = Îº_sat_unfrozen,
    Îº_sat_frozen = Îº_sat_frozen,
);</code></pre><h1 id="Initial-and-Boundary-conditions"><a class="docs-heading-anchor" href="#Initial-and-Boundary-conditions">Initial and Boundary conditions</a><a id="Initial-and-Boundary-conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Initial-and-Boundary-conditions" title="Permalink"></a></h1><p>We will be using a <a href="../../../../../APIs/Land/LandModel/#ClimateMachine.Land.PrescribedWaterModel"><code>PrescribedWaterModel</code></a>, where the user supplies the augmented liquid fraction and ice fraction as functions of space and time. Since we are not implementing phase changes, it makes sense to either have entirely liquid or frozen water. This tutorial shows liquid water.</p><p>Because the two models for thermal conductivity agree well for wetter soil, we&#39;ll choose that here. However, the user could also explore how they differ by choosing drier soil.</p><p>Please note that if the user uses a mix of liquid and frozen water, that they must ensure that the total water content does not exceed porosity.</p><pre><code class="language-julia">prescribed_augmented_liquid_fraction = FT(porosity * 0.8)
prescribed_volumetric_ice_fraction = FT(0.0);</code></pre><p>Choose boundary and initial conditions for heat that will not lead to freezing of water:</p><pre><code class="language-julia">heat_surface_state = (aux, t) -&gt; eltype(aux)(288.15)
heat_bottom_flux = (aux, t) -&gt; eltype(aux)(0.0)
T_init = (aux) -&gt; eltype(aux)(275.15);</code></pre><p>The boundary value problem in this case, with two spatial derivatives, requires a boundary condition at the top of the domain and the bottom. Here we choose to specify a bottom flux condition, and a top state condition. Our problem is effectively 1D, so we do not need to specify lateral boundary conditions.</p><pre><code class="language-julia">bc = LandDomainBC(
    bottom_bc = LandComponentBC(soil_heat = Neumann(heat_bottom_flux)),
    surface_bc = LandComponentBC(soil_heat = Dirichlet(heat_surface_state)),
);</code></pre><p>We also need to define a function <code>init_soil!</code>, which initializes all of the prognostic variables (here, we only have <code>Ïe_int</code>, the volumetric internal energy). The initialization is based on user-specified initial conditions. Note that the user provides initial conditions for heat based on the temperature - <code>init_soil!</code> also converts between <code>T</code> and <code>Ïe_int</code>.</p><pre><code class="language-julia">function init_soil!(land, state, aux, localgeo, time)
    param_set = parameter_set(land)
    Ï_l, Î¸_i = get_water_content(land.soil.water, aux, state, time)
    Î¸_l = volumetric_liquid_fraction(Ï_l, land.soil.param_functions.porosity)
    Ïc_ds = land.soil.param_functions.Ïc_ds
    Ïc_s = volumetric_heat_capacity(Î¸_l, Î¸_i, Ïc_ds, param_set)

    state.soil.heat.Ïe_int = volumetric_internal_energy(
        Î¸_i,
        Ïc_s,
        land.soil.heat.initialT(aux),
        param_set,
    )
end;</code></pre><h1 id="Create-the-model-structure"><a class="docs-heading-anchor" href="#Create-the-model-structure">Create the model structure</a><a id="Create-the-model-structure-1"></a><a class="docs-heading-anchor-permalink" href="#Create-the-model-structure" title="Permalink"></a></h1><pre><code class="language-julia">soil_water_model = PrescribedWaterModel(
    (aux, t) -&gt; prescribed_augmented_liquid_fraction,
    (aux, t) -&gt; prescribed_volumetric_ice_fraction,
);

soil_heat_model = SoilHeatModel(FT; initialT = T_init);</code></pre><p>The full soil model requires a heat model and a water model, as well as the soil parameter functions:</p><pre><code class="language-julia">m_soil = SoilModel(soil_param_functions, soil_water_model, soil_heat_model);</code></pre><p>The equations being solved in this tutorial have no sources or sinks:</p><pre><code class="language-julia">sources = ();</code></pre><p>Finally, we create the <code>LandModel</code>. In more complex land models, this would include the canopy, carbon state of the soil, etc.</p><pre><code class="language-julia">m = LandModel(
    param_set,
    m_soil;
    boundary_conditions = bc,
    source = sources,
    init_state_prognostic = init_soil!,
);</code></pre><h1 id="Specify-the-numerical-details"><a class="docs-heading-anchor" href="#Specify-the-numerical-details">Specify the numerical details</a><a id="Specify-the-numerical-details-1"></a><a class="docs-heading-anchor-permalink" href="#Specify-the-numerical-details" title="Permalink"></a></h1><p>These include the resolution, domain boundaries, integration time, Courant number, and ODE solver.</p><pre><code class="language-julia">N_poly = 1
nelem_vert = 100

zmax = FT(0)
zmin = FT(-1)

driver_config = ClimateMachine.SingleStackConfiguration(
    &quot;LandModel&quot;,
    N_poly,
    nelem_vert,
    zmax,
    param_set,
    m;
    zmin = zmin,
    numerical_flux_first_order = CentralNumericalFluxFirstOrder(),
);</code></pre><pre><code class="language-none">ClimateMachine.array_type() = Array
â Info: Model composition
â     param_set = Main.##350.EarthParameterSet()
â     soil = ClimateMachine.Land.SoilModel{ClimateMachine.Land.SoilParamFunctions{Float32,Float32,Float32,Float32,Float32,Float32,Float32,Float32,Float32,Float32,Float32,Float32,Float32,ClimateMachine.Land.WaterParamFunctions{Float32,ClimateMachine.Land.var&quot;#4#16&quot;{Float32,ClimateMachine.Land.var&quot;#9#21&quot;},ClimateMachine.Land.var&quot;#6#18&quot;{Float32,ClimateMachine.Land.var&quot;#10#22&quot;},ClimateMachine.Land.var&quot;#8#20&quot;{Float32,ClimateMachine.Land.var&quot;#11#23&quot;}}},ClimateMachine.Land.PrescribedWaterModel{Main.##350.var&quot;#17#19&quot;,Main.##350.var&quot;#18#20&quot;},ClimateMachine.Land.SoilHeatModel{Float32,Main.##350.var&quot;#15#16&quot;}}(ClimateMachine.Land.SoilParamFunctions{Float32,Float32,Float32,Float32,Float32,Float32,Float32,Float32,Float32,Float32,Float32,Float32,Float32,ClimateMachine.Land.WaterParamFunctions{Float32,ClimateMachine.Land.var&quot;#4#16&quot;{Float32,ClimateMachine.Land.var&quot;#9#21&quot;},ClimateMachine.Land.var&quot;#6#18&quot;{Float32,ClimateMachine.Land.var&quot;#10#22&quot;},ClimateMachine.Land.var&quot;#8#20&quot;{Float32,ClimateMachine.Land.var&quot;#11#23&quot;}}}(0.395f0, 0.0f0, 0.0f0, 0.92f0, 1.16523f6, 2700.0f0, 7.03731f0, 2.6076639f0, 4.5166464f0, 0.24f0, 18.1f0, 0.053f0, ClimateMachine.Land.WaterParamFunctions{Float32,ClimateMachine.Land.var&quot;#4#16&quot;{Float32,ClimateMachine.Land.var&quot;#9#21&quot;},ClimateMachine.Land.var&quot;#6#18&quot;{Float32,ClimateMachine.Land.var&quot;#10#22&quot;},ClimateMachine.Land.var&quot;#8#20&quot;{Float32,ClimateMachine.Land.var&quot;#11#23&quot;}}(ClimateMachine.Land.var&quot;#4#16&quot;{Float32,ClimateMachine.Land.var&quot;#9#21&quot;}(ClimateMachine.Land.var&quot;#9#21&quot;()), ClimateMachine.Land.var&quot;#6#18&quot;{Float32,ClimateMachine.Land.var&quot;#10#22&quot;}(ClimateMachine.Land.var&quot;#10#22&quot;()), ClimateMachine.Land.var&quot;#8#20&quot;{Float32,ClimateMachine.Land.var&quot;#11#23&quot;}(ClimateMachine.Land.var&quot;#11#23&quot;()))), ClimateMachine.Land.PrescribedWaterModel{Main.##350.var&quot;#17#19&quot;,Main.##350.var&quot;#18#20&quot;}(Main.##350.var&quot;#17#19&quot;(), Main.##350.var&quot;#18#20&quot;()), ClimateMachine.Land.SoilHeatModel{Float32,Main.##350.var&quot;#15#16&quot;}(Main.##350.var&quot;#15#16&quot;()))
â     surface = ClimateMachine.Land.SurfaceFlow.NoSurfaceFlowModel()
â     boundary_conditions = ClimateMachine.Land.LandDomainBC{ClimateMachine.Land.LandComponentBC{ClimateMachine.Land.NoBC,ClimateMachine.Land.Dirichlet{Main.##350.var&quot;#11#12&quot;},ClimateMachine.Land.NoBC},ClimateMachine.Land.LandComponentBC{ClimateMachine.Land.NoBC,ClimateMachine.Land.Neumann{Main.##350.var&quot;#13#14&quot;},ClimateMachine.Land.NoBC},ClimateMachine.Land.LandComponentBC{ClimateMachine.Land.NoBC,ClimateMachine.Land.NoBC,ClimateMachine.Land.NoBC},ClimateMachine.Land.LandComponentBC{ClimateMachine.Land.NoBC,ClimateMachine.Land.NoBC,ClimateMachine.Land.NoBC},ClimateMachine.Land.LandComponentBC{ClimateMachine.Land.NoBC,ClimateMachine.Land.NoBC,ClimateMachine.Land.NoBC},ClimateMachine.Land.LandComponentBC{ClimateMachine.Land.NoBC,ClimateMachine.Land.NoBC,ClimateMachine.Land.NoBC}}(ClimateMachine.Land.LandComponentBC{ClimateMachine.Land.NoBC,ClimateMachine.Land.Dirichlet{Main.##350.var&quot;#11#12&quot;},ClimateMachine.Land.NoBC}(ClimateMachine.Land.NoBC(), ClimateMachine.Land.Dirichlet{Main.##350.var&quot;#11#12&quot;}(Main.##350.var&quot;#11#12&quot;()), ClimateMachine.Land.NoBC()), ClimateMachine.Land.LandComponentBC{ClimateMachine.Land.NoBC,ClimateMachine.Land.Neumann{Main.##350.var&quot;#13#14&quot;},ClimateMachine.Land.NoBC}(ClimateMachine.Land.NoBC(), ClimateMachine.Land.Neumann{Main.##350.var&quot;#13#14&quot;}(Main.##350.var&quot;#13#14&quot;()), ClimateMachine.Land.NoBC()), ClimateMachine.Land.LandComponentBC{ClimateMachine.Land.NoBC,ClimateMachine.Land.NoBC,ClimateMachine.Land.NoBC}(ClimateMachine.Land.NoBC(), ClimateMachine.Land.NoBC(), ClimateMachine.Land.NoBC()), ClimateMachine.Land.LandComponentBC{ClimateMachine.Land.NoBC,ClimateMachine.Land.NoBC,ClimateMachine.Land.NoBC}(ClimateMachine.Land.NoBC(), ClimateMachine.Land.NoBC(), ClimateMachine.Land.NoBC()), ClimateMachine.Land.LandComponentBC{ClimateMachine.Land.NoBC,ClimateMachine.Land.NoBC,ClimateMachine.Land.NoBC}(ClimateMachine.Land.NoBC(), ClimateMachine.Land.NoBC(), ClimateMachine.Land.NoBC()), ClimateMachine.Land.LandComponentBC{ClimateMachine.Land.NoBC,ClimateMachine.Land.NoBC,ClimateMachine.Land.NoBC}(ClimateMachine.Land.NoBC(), ClimateMachine.Land.NoBC(), ClimateMachine.Land.NoBC()))
â     source = ()
â     source_dt = DispatchedTuples.DispatchedTuple{Tuple{},DispatchedTuples.NoDefaults} with 0 entries:
â   default =&gt; ()
â 
â     init_state_prognostic = init_soil!
â @ ClimateMachine /central/scratch/climaci/climatemachine-docs/1372/climatemachine-docs/src/Driver/driver_configs.jl:188
â Warning: This table is temporarily incomplete
â @ ClimateMachine.BalanceLaws /central/scratch/climaci/climatemachine-docs/1372/climatemachine-docs/src/BalanceLaws/show_tendencies.jl:51

PDE: â_t Y_i + (ââ¢F_1(Y))_i + (ââ¢F_2(Y,G)))_i = (S(Y,G))_i
ââââââââââââââââââââââââââââ¬âââââââââââââââââââ¬ââââââââââââââââââââ¬âââââââââ
â                 Equation â Flux{FirstOrder} â Flux{SecondOrder} â Source â
â                    (Y_i) â            (F_1) â             (F_2) â    (S) â
ââââââââââââââââââââââââââââ¼âââââââââââââââââââ¼ââââââââââââââââââââ¼âââââââââ¤
â VolumetricInternalEnergy â               () â    (DiffHeatFlux) â     () â
ââââââââââââââââââââââââââââ´âââââââââââââââââââ´ââââââââââââââââââââ´âââââââââ

â Info: Establishing single stack configuration for LandModel
â     precision               = Float32
â     horiz polynomial order  = 1
â     vert polynomial order   = 1
â     domain_min              = 0.00 m, 0.00 m, -1.00 m
â     domain_max              = 1.00 m, 1.00 m, 0.00 m
â     # vert elems            = 100
â     MPI ranks               = 1
â     min(Î_horz)             = 1.00 m
â     min(Î_vert)             = 0.01 m
â @ ClimateMachine /central/scratch/climaci/climatemachine-docs/1372/climatemachine-docs/src/Driver/driver_configs.jl:612
</code></pre><p>In this tutorial, we determine a timestep based on a Courant number ( also called a Fourier number in the context of the heat equation). In short, we can use the parameters of the model (<code>Îº</code> and <code>Ïc_s</code>), along with with the size of elements of the grid used for discretizing the PDE, to estimate a natural timescale for heat transfer across a grid cell. Because we are using an explicit ODE solver, the timestep should be a fraction of this in order to resolve the dynamics.</p><p>This allows us to automate, to a certain extent, choosing a value for the timestep, even as we switch between soil types.</p><pre><code class="language-julia">function calculate_dt(dg, model::LandModel, Q, Courant_number, t, direction)
    Ît = one(eltype(Q))
    CFL = DGMethods.courant(diffusive_courant, dg, model, Q, Ît, t, direction)
    return Courant_number / CFL
end

function diffusive_courant(
    m::LandModel,
    state::Vars,
    aux::Vars,
    diffusive::Vars,
    Îx,
    Ît,
    t,
    direction,
)
    param_set = parameter_set(m)
    soil = m.soil
    Ï_l, Î¸_i = get_water_content(soil.water, aux, state, t)
    Î¸_l = volumetric_liquid_fraction(Ï_l, soil.param_functions.porosity)
    Îº_dry = k_dry(param_set, soil.param_functions)
    S_r = relative_saturation(Î¸_l, Î¸_i, soil.param_functions.porosity)
    kersten = kersten_number(Î¸_i, S_r, soil.param_functions)
    Îº_sat = saturated_thermal_conductivity(
        Î¸_l,
        Î¸_i,
        soil.param_functions.Îº_sat_unfrozen,
        soil.param_functions.Îº_sat_frozen,
    )
    Îº = thermal_conductivity(Îº_dry, kersten, Îº_sat)
    Ïc_ds = soil.param_functions.Ïc_ds
    Ïc_s = volumetric_heat_capacity(Î¸_l, Î¸_i, Ïc_ds, param_set)
    return Ît * Îº / (Îx * Îx * Ïc_ds)
end


t0 = FT(0)
timeend = FT(60 * 60 * 3)
Courant_number = FT(0.5) # much bigger than this leads to domain errors

solver_config = ClimateMachine.SolverConfiguration(
    t0,
    timeend,
    driver_config;
    Courant_number = Courant_number,
    CFL_direction = VerticalDirection(),
);</code></pre><pre><code class="language-none">â Info: Initializing LandModel
â @ ClimateMachine /central/scratch/climaci/climatemachine-docs/1372/climatemachine-docs/src/Driver/solver_configs.jl:185
</code></pre><h1 id="Run-the-integration"><a class="docs-heading-anchor" href="#Run-the-integration">Run the integration</a><a id="Run-the-integration-1"></a><a class="docs-heading-anchor-permalink" href="#Run-the-integration" title="Permalink"></a></h1><pre><code class="language-julia">ClimateMachine.invoke!(solver_config);
state_types = (Prognostic(), Auxiliary())
dons = dict_of_nodal_states(solver_config, state_types; interp = true)</code></pre><pre><code class="language-none">OrderedCollections.OrderedDict{String,Array{Float32,1}} with 5 entries:
  &quot;soil.heat.Ïe_int&quot; =&gt; Float32[4.94801f6, 4.94799f6, 4.948f6, 4.94801f6, 4.94798f6, 4.94798f6, 4.948f6, 4.94798f6, 4.94802f6, 4.94798f6, 4.948f6, 4.94797f6, 4.94802f6, 4.94796f6, 4.94798f6, 4.948f6, 4.948f6, 4.94798f6, 4.94799f6, 4.94799f6, 4.94799f6, 4.94801f6, 4.94798f6, 4.94802f6, 4.94796f6, 4.94799f6, 4.94798f6, 4.94799f6, 4.94799f6, 4.94799f6, 4.94798f6, 4.94801f6, 4.94803f6, 4.94809f6, 4.94816f6, 4.94823f6, 4.94832f6, 4.94842f6, 4.94864f6, 4.94889f6, 4.94919f6, 4.94963f6, 4.95021f6, 4.95094f6, 4.95191f6, 4.95317f6, 4.95481f6, 4.95691f6, 4.9596f6, 4.96301f6, 4.96741f6, 4.97287f6, 4.97985f6, 4.98856f6, 4.99934f6, 5.01285f6, 5.02946f6, 5.0499f6, 5.07488f6, 5.10542f6, 5.14235f6, 5.18697f6, 5.24062f6, 5.30472f6, 5.38103f6, 5.47153f6, 5.57814f6, 5.70333f6, 5.84961f6, 6.01969f6, 6.21657f6, 6.44343f6, 6.70347f6, 7.00034f6, 7.33749f6, 7.71874f6, 8.14775f6, 8.62825f6, 9.16392f6, 9.75827f6, 1.04147f7, 1.11361f7, 1.19254f7, 1.27847f7, 1.3716f7, 1.47205f7, 1.57989f7, 1.69511f7, 1.81764f7, 1.94733f7, 2.08395f7, 2.22719f7, 2.37666f7, 2.53190f7, 2.69236f7, 2.85745f7, 3.0265f7, 3.19877f7, 3.37351f7, 3.54991f7, 3.63843f7]
  &quot;x&quot; =&gt; Float32[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
  &quot;y&quot; =&gt; Float32[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
  &quot;z&quot; =&gt; Float32[-1.0, -0.99, -0.98, -0.97, -0.96, -0.95, -0.94, -0.93, -0.92, -0.91, -0.9, -0.89, -0.88, -0.87, -0.86, -0.85, -0.84, -0.83, -0.82, -0.81, -0.8, -0.79, -0.78, -0.77, -0.76, -0.75, -0.74, -0.73, -0.72, -0.71, -0.7, -0.69, -0.68, -0.67, -0.66, -0.65, -0.64, -0.63, -0.62, -0.61, -0.6, -0.59, -0.58, -0.57, -0.56, -0.55, -0.54, -0.53, -0.52, -0.51, -0.5, -0.49, -0.48, -0.47, -0.46, -0.45, -0.44, -0.43, -0.42, -0.41, -0.4, -0.39, -0.38, -0.37, -0.36, -0.35, -0.34, -0.33, -0.32, -0.31, -0.3, -0.29, -0.28, -0.27, -0.26, -0.25, -0.24, -0.23, -0.22, -0.21, -0.2, -0.19, -0.18, -0.17, -0.16, -0.15, -0.14, -0.13, -0.12, -0.11, -0.1, -0.09, -0.08, -0.07, -0.06, -0.05, -0.04, -0.03, -0.02, -0.01, -2.98023f-10]
  &quot;soil.heat.T&quot; =&gt; Float32[275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.15, 275.151, 275.151, 275.151, 275.152, 275.152, 275.153, 275.154, 275.155, 275.156, 275.158, 275.16, 275.163, 275.166, 275.171, 275.176, 275.183, 275.191, 275.201, 275.213, 275.228, 275.246, 275.268, 275.293, 275.324, 275.361, 275.403, 275.454, 275.513, 275.581, 275.66, 275.751, 275.856, 275.975, 276.111, 276.264, 276.437, 276.63, 276.845, 277.084, 277.348, 277.638, 277.956, 278.302, 278.676, 279.08, 279.514, 279.977, 280.47, 280.992, 281.541, 282.117, 282.718, 283.343, 283.988, 284.652, 285.332, 286.025, 286.728, 287.437, 287.793]</code></pre><h1 id="Plot-results-and-comparison-data-from-[Bonan19a](@cite)"><a class="docs-heading-anchor" href="#Plot-results-and-comparison-data-from-[Bonan19a](@cite)">Plot results and comparison data from <a href="../../../../../References/#Bonan19a">G. Bonan  (2019)</a></a><a id="Plot-results-and-comparison-data-from-[Bonan19a](@cite)-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-results-and-comparison-data-from-[Bonan19a](@cite)" title="Permalink"></a></h1><pre><code class="language-julia">z = get_z(solver_config.dg.grid; rm_dupes = true);
T = dons[&quot;soil.heat.T&quot;];
plot(
    T,
    z,
    label = &quot;ClimateMachine&quot;,
    ylabel = &quot;z (m)&quot;,
    xlabel = &quot;T (K)&quot;,
    title = &quot;Heat transfer in sand&quot;,
)
plot!(T_init.(z), z, label = &quot;Initial condition&quot;)
filename = &quot;bonan_heat_data.csv&quot;
bonan_dataset = ArtifactWrapper(
    @__DIR__,
    isempty(get(ENV, &quot;CI&quot;, &quot;&quot;)),
    &quot;bonan_soil_heat&quot;,
    ArtifactFile[ArtifactFile(
        url = &quot;https://caltech.box.com/shared/static/99vm8q8tlyoulext6c35lnd3355tx6bu.csv&quot;,
        filename = filename,
    ),],
)
bonan_dataset_path = get_data_folder(bonan_dataset)
data = joinpath(bonan_dataset_path, filename)
ds_bonan = readdlm(data, &#39;,&#39;)
bonan_T = reverse(ds_bonan[:, 2])
bonan_z = reverse(ds_bonan[:, 1])
bonan_T_continuous = Spline1D(bonan_z, bonan_T)
bonan_at_clima_z = bonan_T_continuous.(z)
plot!(bonan_at_clima_z, z, label = &quot;Bonan simulation&quot;)
plot!(legend = :bottomleft)
savefig(&quot;thermal_conductivity_comparison.png&quot;)</code></pre><p><img src="../thermal_conductivity_comparison.png" alt/></p><p>The plot shows that the temperature at the top of the soil is gradually increasing. This is because the surface temperature is held fixed at a value larger than the initial temperature. If we ran this for longer, we would see that the bottom of the domain would also increase in temperature because there is no heat leaving the bottom (due to zero heat flux specified in the boundary condition).</p><h1 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h1><ul><li><a href="../../../../../References/#Bonan19a">G. Bonan  (2019)</a></li><li><a href="../../../../../References/#Johanson1975">O. Johanson  (1977)</a></li><li><a href="../../../../../References/#BallandArp2005">V. Balland , P. A. Arp  (2005)</a></li><li><a href="../../../../../References/#Dai2019a">Yongjiu Dai al.  (2019)</a></li><li><a href="../../../../../References/#Cosby1984">B.J. Cosby al.  (1984)</a></li></ul><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../Water/hydraulic_functions/">Â« Hydraulic Functions</a><a class="docs-footer-nextpage" href="../../Water/equilibrium_test/">Richards Equation Â»</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 7 June 2021 14:21">Monday 7 June 2021</span>. Using Julia version 1.5.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
