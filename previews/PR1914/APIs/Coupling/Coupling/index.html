<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Coupling Â· ClimateMachine</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.svg" alt="ClimateMachine logo"/></a><div class="docs-package-name"><span class="docs-autofit">ClimateMachine</span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Getting started</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../GettingStarted/Installation/">Installation</a></li><li><a class="tocitem" href="../../../GettingStarted/Terminology/">Terminology</a></li><li><a class="tocitem" href="../../../GettingStarted/RunningClimateMachine/">Running</a></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Defaults</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../GettingStarted/Atmos/">Atmosphere model configurations</a></li></ul></li></ul></li><li><span class="tocitem">Tutorials</span></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">How-to-guides</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Common/Thermodynamics/">Thermodynamics</a></li><li><a class="tocitem" href="../../../HowToGuides/Common/UniversalFunctions/">Universal Functions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Balance Laws</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/BalanceLaws/how_to_make_a_balance_law/">How to make a balance law</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Atmos/TemperatureProfiles/">Temperature profiles</a></li><li><a class="tocitem" href="../../../HowToGuides/Atmos/AtmosReferenceState/">Reference profiles</a></li><li><a class="tocitem" href="../../../HowToGuides/Atmos/MoistureModelChoices/">Moisture model</a></li><li><a class="tocitem" href="../../../HowToGuides/Atmos/PrecipitationModelChoices/">Precipitation model</a></li><li><a class="tocitem" href="../../../HowToGuides/Atmos/MoistureAndPrecip/">How to create an experiment with moisture and precipitation</a></li></ul></li><li><span class="tocitem">Ocean</span></li><li><span class="tocitem">Land</span></li><li><input class="collapse-toggle" id="menuitem-4-6" type="checkbox"/><label class="tocitem" for="menuitem-4-6"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><span class="tocitem">Meshes</span></li><li><input class="collapse-toggle" id="menuitem-4-6-2" type="checkbox"/><label class="tocitem" for="menuitem-4-6-2"><span class="docs-label">ODE Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Numerics/ODESolvers/Timestepping/">Time-integration</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-6-3" type="checkbox"/><label class="tocitem" for="menuitem-4-6-3"><span class="docs-label">System Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Numerics/SystemSolvers/IterativeSolvers/">Iterative Solvers</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-7" type="checkbox"/><label class="tocitem" for="menuitem-4-7"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Diagnostics/UsingDiagnostics/">Using Diagnostics</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox" checked/><label class="tocitem" for="menuitem-5"><span class="docs-label">APIs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Driver</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Driver/">Top level interface</a></li><li><a class="tocitem" href="../../Driver/Checkpoint/">Checkpoint</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Atmos/AtmosModel/">AtmosModel</a></li><li><a class="tocitem" href="../../Atmos/Microphysics_0M/">Microphysics_0M</a></li><li><a class="tocitem" href="../../Atmos/Microphysics/">Microphysics</a></li><li><a class="tocitem" href="../../Atmos/TemperatureProfiles/">Temperature Profiles</a></li></ul></li><li><a class="tocitem" href="../../Ocean/Ocean/">Ocean</a></li><li><input class="collapse-toggle" id="menuitem-5-5" type="checkbox"/><label class="tocitem" for="menuitem-5-5"><span class="docs-label">Land</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Land/LandModel/">Land Model</a></li><li><a class="tocitem" href="../../Land/Runoff/">Runoff Parameterizations</a></li><li><a class="tocitem" href="../../Land/SoilWaterParameterizations/">Soil Water Parameterizations</a></li><li><a class="tocitem" href="../../Land/SoilHeatParameterizations/">Soil Heat Parameterizations</a></li></ul></li><li class="is-active"><a class="tocitem" href>Coupling</a><ul class="internal"><li><a class="tocitem" href="#Methods"><span>Methods</span></a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-7" type="checkbox"/><label class="tocitem" for="menuitem-5-7"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Common/Orientations/">Orientations</a></li><li><a class="tocitem" href="../../Common/Spectra/">Spectra</a></li><li><a class="tocitem" href="../../Common/SurfaceFluxes/">Surface Fluxes</a></li><li><a class="tocitem" href="../../Common/Thermodynamics/">Thermodynamics</a></li><li><a class="tocitem" href="../../Common/TurbulenceClosures/">Turbulence Closures</a></li><li><a class="tocitem" href="../../Common/TurbulenceConvection/">Turbulence Convection</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-8" type="checkbox"/><label class="tocitem" for="menuitem-5-8"><span class="docs-label">Balance Laws</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../BalanceLaws/BalanceLaws/">Balance Laws</a></li><li><a class="tocitem" href="../../BalanceLaws/Problems/">Problems</a></li></ul></li><li><a class="tocitem" href="../../Arrays/Arrays/">Arrays</a></li><li><input class="collapse-toggle" id="menuitem-5-10" type="checkbox"/><label class="tocitem" for="menuitem-5-10"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Diagnostics/Diagnostics/">Diagnostics groups</a></li><li><a class="tocitem" href="../../Diagnostics/StateCheck/">State Check</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-11" type="checkbox"/><label class="tocitem" for="menuitem-5-11"><span class="docs-label">Input/Output</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../InputOutput/">Input/Output</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-12" type="checkbox"/><label class="tocitem" for="menuitem-5-12"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Numerics/Meshes/Mesh/">Meshes</a></li><li><a class="tocitem" href="../../Numerics/SystemSolvers/SystemSolvers/">SystemSolvers</a></li><li><a class="tocitem" href="../../Numerics/ODESolvers/ODESolvers/">ODESolvers</a></li><li><a class="tocitem" href="../../Numerics/DGMethods/DGMethods/">DG Methods</a></li><li><a class="tocitem" href="../../Numerics/DGMethods/Courant/">Courant</a></li><li><a class="tocitem" href="../../Numerics/DGMethods/NumericalFluxes/">Numerical Fluxes</a></li><li><a class="tocitem" href="../../Numerics/DGMethods/FVReconstructions/">Finite Volume Reconstructions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-13" type="checkbox"/><label class="tocitem" for="menuitem-5-13"><span class="docs-label">Utilities</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Utilities/VariableTemplates/">Variable Templates</a></li><li><a class="tocitem" href="../../Utilities/SingleStackUtils/">Single Stack Utilities</a></li><li><a class="tocitem" href="../../Utilities/TicToc/">Tic Toc</a></li></ul></li></ul></li><li><a class="tocitem" href="../../../Contributing/">Contribution guide</a></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Theory</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-7-1" type="checkbox"/><label class="tocitem" for="menuitem-7-1"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Theory/Common/SurfaceFluxes/">SurfaceFluxes</a></li><li><a class="tocitem" href="../../../Theory/Common/Turbulence/">Turbulence Closures</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7-2" type="checkbox"/><label class="tocitem" for="menuitem-7-2"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Theory/Atmos/AtmosModel/">AtmosModel</a></li><li><a class="tocitem" href="../../../Theory/Atmos/EDMF_plots/">EDMF Model</a></li><li><a class="tocitem" href="../../../Theory/Atmos/Microphysics_0M/">Microphysics_0M</a></li><li><a class="tocitem" href="../../../Theory/Atmos/Microphysics/">Microphysics</a></li><li><a class="tocitem" href="../../../Theory/Atmos/EDMFEquations/">EDMF equations</a></li><li><a class="tocitem" href="../../../Theory/Atmos/Model/tracers/">Tracers</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">Developer docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../DevDocs/CodeStyle/">Coding style</a></li><li><a class="tocitem" href="../../../DevDocs/AcceptableUnicode/">Acceptable Unicode</a></li><li><a class="tocitem" href="../../../DevDocs/ModelVariableList/">Model variable list</a></li><li><a class="tocitem" href="../../../DevDocs/ModelOutput/">Model output</a></li><li><a class="tocitem" href="../../../DevDocs/DiagnosticVariableList/">Diagnostic variable list</a></li><li><a class="tocitem" href="../../../DevDocs/SystemImage/">Custom System Image</a></li></ul></li><li><a class="tocitem" href="../../../References/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">APIs</a></li><li class="is-active"><a href>Coupling</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Coupling</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimateMachine.jl/blob/master/docs/src/APIs/Coupling/Coupling.md" title="Edit on GitHub"><span class="docs-icon fab">ï</span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Coupling-API"><a class="docs-heading-anchor" href="#Coupling-API">Coupling API</a><a id="Coupling-API-1"></a><a class="docs-heading-anchor-permalink" href="#Coupling-API" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-binding" id="ClimateMachine.Coupling" href="#ClimateMachine.Coupling"><code>ClimateMachine.Coupling</code></a> â <span class="docstring-category">Module</span></header><section><div><pre><code class="language-julia">Coupling</code></pre><p>Primitive coupling module sufficient for initial atmos-ocean-land coupled simulation.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimateMachine.jl/blob/8c579d6eb2ea25312edaca6ecb8ea35a8632f331/src/Coupling/Coupling.jl#L1-L5">source</a></section></article><h2 id="Methods"><a class="docs-heading-anchor" href="#Methods">Methods</a><a id="Methods-1"></a><a class="docs-heading-anchor-permalink" href="#Methods" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="ClimateMachine.Coupling.CplState" href="#ClimateMachine.Coupling.CplState"><code>ClimateMachine.Coupling.CplState</code></a> â <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">CplState(;)</code></pre><p>Type for holding Coupler &quot;state&quot;. This is the namespace through which coupled components communicate. Its role is to provide a level of indirection so that components remain modular and so that any data communication, interpolation, reindexing/unit conversions and filtering  etc... can be embeded in the intermdediate coupling layer.</p><p>To start with we can just use a dictionary key and value table that holds labelled pointers to various fields. A field is exported by one component and imported by one or more other components. Components can select which fields are needed by using the Dict symbols.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimateMachine.jl/blob/8c579d6eb2ea25312edaca6ecb8ea35a8632f331/src/Coupling/CplState.jl#L5-L16">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimateMachine.Coupling.CplTestModel" href="#ClimateMachine.Coupling.CplTestModel"><code>ClimateMachine.Coupling.CplTestModel</code></a> â <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">CplTestModel(;domain,
              equations,
              nsteps,
              btags=((0,0),(0,0),(1,2) ),
              dt=1.,
              NFSecondOrder=CentralNumericalFluxSecondOrder())</code></pre><p>Builds an instance of a coupler test model.  This is a toy model used for testing and designing coupling machinery. In a full-blown coupled experiment this model would be replaced by a full compnent model.</p><pre><code class="language-none">  -  `domain` the spatial mesh used by this model. 
  -  `equations` the Balance Law used by this model.
  -  `nsteps` number of component steps to run during each coupling step.
  -  `btags` boundary labels for different edges.
  -  `dt` component timestep to use on each component step.
  -  `NFSecondOrder` numerical flux to use for second order terms.</code></pre><p>Each returned model instance is independent and has its own grid, balance law, time stepper and other attributes.  For now the code keeps some of these things the same for initial testing, including component timestepper and initial time (both of which need tweaking to use for real setups).</p><p>The argumetns and btags and NFSecondOrder are useful for this particular model. A real model might have many more flags and/or may wrap the component creation very differently. Any component should allow itself to set a number of timesteps to execute with a certain timestep to synchronize with the coupling time scale.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimateMachine.jl/blob/8c579d6eb2ea25312edaca6ecb8ea35a8632f331/src/Coupling/CplTestModel.jl#L12-L42">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimateMachine.ODESolvers.CplSolver" href="#ClimateMachine.ODESolvers.CplSolver"><code>ClimateMachine.ODESolvers.CplSolver</code></a> â <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">CplSolver( ;component_list, cdt, t0 = 0 )</code></pre><p>A time stepping like object for advancing a coupled system made up of a pre-defined set of named components specified in <code>component_list</code>. Each component is a balance law, discretization and timestepper collection. The coupler will step them forward by a nsteps substeps to advance the coupled system by a simulated time cdt.</p><p>Components are registered with pre<em>step() and post</em>step() functions. The pre<em>step() functions get fields for use in the component from the coupler name space. The post</em>step() functions put fields for use by other components into te coupler name space.  The CplSolver abstraction controls</p><ol><li>the outer time stepping sequencing of components</li><li>the excution of actions mapping exports from one or more components to imports of other components through an intermediary coupler name space.</li></ol><p>Some notes -</p><p>For now components need to include slightly wasteful &quot;shadow&quot; variables for accumulating boundary flux terms they compute across RK stages and across timesteps. These are defined within the component balance law. The shadown variable is a full 3d array because of the way the current  infrastructure works. This can be tidied up later once design is settled.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimateMachine.jl/blob/8c579d6eb2ea25312edaca6ecb8ea35a8632f331/src/Numerics/ODESolvers/CplSolver.jl#L3-L28">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../Land/SoilHeatParameterizations/">Â« Soil Heat Parameterizations</a><a class="docs-footer-nextpage" href="../../Common/Orientations/">Orientations Â»</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 22 February 2021 23:35">Monday 22 February 2021</span>. Using Julia version 1.5.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
